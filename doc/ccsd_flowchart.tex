
\begin{center}
\footnotesize
\begin{tikzpicture}[
  ->,
  double,
  very thick]
%  \def\lsT{0.2cm}; % line spacing after node's title
%  \def\ls{0.1cm}; % line spacing inside node


  % ======
  \node (init)  at (\C{0.3}, \T{-1.5})
  [algstep, text width=\W{80}]
  {
    \textbf{Initialisation}\\\vspace{\lsT}
    {\footnotesize $\Psi_{CC}$ as instance of \texttt{wave\_functions.IntermNormWF}}\\\vspace{\ls}
  };
  % ------

  % ======
  \node (ener)  at (\C{-0.0}, \T{0.0})
  [algstep, text width=\W{80}, hyperlink node=sec:ccsd_energy]
  {
    \textbf{Energy}\\\vspace{\lsT}
    {\footnotesize \texttt{wave\_functions.IntermNormWF.energy}}\\\vspace{\ls}
  };
  % ------

  % ======
  \node (conv)  at (\C{-0.0}, \T{1.0})
  [algcond, text width=\W{40}, hyperlink node=sec:ccsd_energy]
  {
    \textbf{Converged?}\\\vspace{\lsT}
    {\footnotesize $|\Omega| < \epsilon$}\\\vspace{\ls}
  };
  % ------

  % ======
  \node (transf_hg)  at (\C{-0.0}, \T{2.0})
  [algstep, text width=\W{80}, hyperlink node=sec:ccsd_energy]
  {
    \textbf{$T_1$ transformed Hamiltonian}\\\vspace{\lsT}
    {\footnotesize \texttt{coupled\_cluster.ccsd.get\_t1\_transf}}\\\vspace{\ls}
  };
  % ------

  
  % ================================================
  \node (res) at (\C{0.0}, \T{4.0})
  [algmultistep, text width=\W{150}, minimum height=4cm, hyperlink node=sec:ccsd_res]
  {
    \textbf{Set residual}\\\vspace{\lsT}
    \begin{minipage}[t][5cm]{0.4\textwidth}
      \centering
      {\footnotesize \texttt{coupled\_cluster.ccsd.equation}}\\\vspace{\ls}
    \end{minipage}
  };


  % % ======
  % \node (resterm1) at (\C{-1.0}, \T{2.0})
  % [algstep, text width=\W{50}, hyperlink node=sec:ccsd_res_sing]
  % {
  %   \textbf{Set res. singles ($\Omega_i^a$)}\\\vspace{\lsT}
  %   {\footnotesize \texttt{ccsd.equation.res\_singles}}\\\vspace{\ls}
  % };
  % % ------

  % % ======
  % \node (resterm2) at (\C{1.0}, \T{2.0})
  % [algstep, text width=\W{50}, hyperlink node=sec:ccsd_res_doub]
  % {
  %   \textbf{Set res. doubles ($\Omega_{ij}^{ab}$)}\\\vspace{\lsT}
  %   {\footnotesize \texttt{ccsd.equation.res\_doubles}}\\\vspace{\ls}
  % };
  % % ------
  
  % ------------------------------------------------

  
  % ======
  \node (update) at (\C{0.0}, \T{6.0})
  [algstep, text width=\W{90}, hyperlink node=sec:ccsd_update]
  {
    \textbf{Update amplitudes}\\\vspace{\lsT}
    \begin{minipage}{0.4\textwidth}
      \centering
      {\footnotesize \texttt{coupled\_cluster.ccsd.step}}\\\vspace{\ls}
    \end{minipage}
  };
  % ------



  \draw [->] (init.270) -- (ener.50);
  \draw [->] (ener.270) -- (conv.90);
  \draw [->, condFalse] (conv.270) -- (transf_hg.90);
  \draw [->, condTrue] (conv.0) -- (\C{2.0}, \T{1.0});
  \draw [->] (transf_hg.270) -- (res.90);
  \draw [->] (res.270) .. controls +(down:1.5cm) and +(up:1.5cm) .. (update.90);

  \draw [->] (update.270) -- (\C{0.0}, \T{7.0})  --  (\C{-2.0}, \T{7.0}) --
  (\C{-2.0}, \T{-0.5}) -- (\C{-0.3}, \T{-0.5}) -- (ener.130);

  % ------

\end{tikzpicture}
\end{center}

 	

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "grassmann_doc.tex"
%%% End:
