\begin{center}
\footnotesize
\begin{tikzpicture}[
  ->,
  double,
  very thick]

  \node (import) at (\X{-50}, \Y{-18}) [anchor=west]
  {\texttt{from wave\_functions import interm\_norm}};
  \node (import) at (\X{-50}, \Y{-15}) [anchor=west]
  {\texttt{from coupled\_cluster import ccsd}};

  % ======
  \node (init)  at (\X{20}, \Y{-15})
  [algstep, text width=\W{50}]
  {
    \textbf{Initialisation}\vspT
    {$\Psi_{CC}$ as instance of \texttt{interm\_norm.IntermNormWF}}\vsp
  };
  % ------

  % ======
  \node (ener)  at (\X{0}, \Y{0})
  [algstep, text width=\W{50}, hyperlink node=sec:ccsd_energy]
  {
    \textbf{Energy}\vspT
    ?? \texttt{interm\_norm.IntermNormWF.energy}\vsp
    ?? \texttt{ccsd.energy}\vsp
  };
  % ------

  % ======
  \node (conv)  at (\X{0}, \Y{15})
  [algcond, text width=\W{20}, hyperlink node=sec:ccsd_energy]
  {
    \textbf{Converged?}\vspT
    {$|\Omega| < \epsilon$}\vsp
  };
  % ------

  % ======
  \node (cc_version)  at (\X{-30}, \Y{30})
  [algcond, text width=\W{20}]
  {
    \textbf{CC version?}\vspT
  };
  % ------

  % ======
  \node (transf_hg)  at (\X{20}, \Y{30})
  [algstep, text width=\W{50}, hyperlink node=sec:ccsd_energy]
  {
    \textbf{$T_1$ transformed Hamiltonian}\vspT
    \texttt{coupled\_cluster.ccsd.get\_t1\_transf}\vsp
  };
  % ------

  
  % ================================================
  \node (res) at (\X{0}, \Y{70})
  [algmultistep, text width=\W{80}, hyperlink node=sec:ccsd_res]
  {
    \begin{minipage}[t][7cm]{1.0\textwidth}
      \centering
      \textbf{Set residual}\vspT
      \texttt{coupled\_cluster.ccsd.equation}\vsp
    \end{minipage}
  };


  % ======
  \node (res_sing) at (\X{20}, \Y{70})
  [algstep, text width=\W{30}, hyperlink node=sec:ccsd_res_sing]
  {
    \textbf{Singles, $\Omega_i^a$}\vspT
    \texttt{ccsd.equation.res\_singles}\vsp
  };
  % ------

  % ======
  \node (res_doub) at (\X{-20}, \Y{80})
  [algstep, text width=\W{30}, hyperlink node=sec:ccsd_res_doub]
  {
    \textbf{Doubles, $\Omega_{ij}^{ab}$}\vspT
    \texttt{ccsd.equation.res\_doubles}\vsp
  };
  % ------
  
  % ------------------------------------------------

  
  % ======
  \node (update) at (\X{0}, \Y{100})
  [algstep, text width=\W{50}, hyperlink node=sec:ccsd_update]
  {
    \textbf{Update amplitudes}\vspT
    \texttt{interm\_norm.IntermNormWF.update\_amplitudes}\vsp
  };
  % ------


  \draw [->] (init.270) -- (ener.50);
  \draw [->] (ener.270) -- (conv.90);
  \draw [->, condFalse] (conv.180) .. controls +(left:2) and +(up:1) .. (cc_version.90);
  \draw [->, condTrue] (conv.0) -- (\X{30}, \Y{15});
  \draw [->] (cc_version.0) -- (transf_hg.180)
  node [midway, above, sloped] (cc) {CCSD};
  \draw [->] (cc_version.270) .. controls +(down:1) and +(up:1) .. (res.110)
  node [midway, above, sloped] (cc) {CCD};
  \draw [->] (transf_hg.270) .. controls +(down:1) and +(up:1) .. (res.70);
  \draw [->] (res.270) -- (update.90);

  \algloop{update.270}{110}{-10}{ener.130}
  

  % ------

\end{tikzpicture}
\end{center}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "grassmann_doc.tex"
%%% End:
