"""Tests for IntermNormWaveFunction

"""
import unittest
import cProfile
import pstats
from pstats import SortKey

import numpy as np

from wave_functions import fci
from wave_functions.interm_norm import IntermNormWaveFunction
import tests



@tests.category('SHORT')
class FromMolproTestCase(unittest.TestCase):

    def setUp(self):
        self.addTypeEqualityFunc(np.ndarray, tests.assert_arrays)

    def test_h2_sto3g_d2h(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('H2__5__sto3g__D2h'))
        self.assertEqual(wf.get_amplitudes(), np.array([-0.86355553]))
        self.assertEqual(wf.n_irrep, 8)
        self.assertTrue(wf.restricted)

    def test_h2_631g_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('H2__5__631g__C2v'))
        self.assertEqual(wf.get_amplitudes(), np.array(
            # Singles:
            [#               i, a       irrep = 0
             -0.00000000,  # 0, 0
              0.07852602,  # 0, 1
             -0.00000000,  # 0, 2
             # ==============================================
             # Doubles:
             # ---> pair ij = 0: (i, i_irrep) = (0, 0)   j, j_irrep = (0, 0)
             #               a, b     irrep_a = 0
             -0.78356502,  # 0, 0
              0.00000000,  # 0, 1
             -0.07011574,  # 0, 2
              0.00000000,  # 1, 0
             -0.00272632,  # 1, 1
             -0.00000000,  # 1, 2
             -0.07011574,  # 2, 0
             -0.00000000,  # 2, 1
             -0.00808512,  # 2, 2
            ]))
        self.assertEqual(wf.n_irrep, 4)
        self.assertTrue(wf.restricted)

    def test_h2_ccpvdz_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('H2__5__ccpVDZ__C2v'))
        my_ampl = np.array(
            # Singles:
            [#               i, a    irrep = 0
              0.00000000,  # 0, 0
             -0.10780149,  # 0, 1
              0.00000000,  # 0, 2
             -0.00566969,  # 0, 3
              0.00000000,  # 0, 4
              # ==============================================
              # Doubles:
              # ---> pair ij = 0: (i, i_irrep) = (0, 0)   j, j_irrep = (0, 0)
              #              a, b     irrep_a = 0
             -0.76921165,  # 0, 0
             -0.00000000,  # 0, 1
              0.10150132,  # 0, 2
              0.00000000,  # 0, 3
             -0.00563809,  # 0, 4
             -0.00000000,  # 1, 0
             -0.00322314,  # 1, 1
             -0.00000000,  # 1, 2
              0.00021971,  # 1, 3
             -0.00000000,  # 1, 4
              0.10150132,  # 1, 0
             -0.00000000,  # 2, 1
             -0.01518971,  # 2, 2
             -0.00000000,  # 2, 3
              0.00068753,  # 2, 4
              0.00000000,  # 3, 0
              0.00021971,  # 3, 1
             -0.00000000,  # 3, 2
             -0.00549708,  # 3, 3
              0.00000000,  # 3, 4
             -0.00563809,  # 4, 0
             -0.00000000,  # 4, 1
              0.00068753,  # 4, 2
              0.00000000,  # 4, 3
             -0.00120278,  # 4, 4
              #              a, b     irrep_a = 1
             -0.00374441,  # 0, 0
              0.00000000,  # 0, 1
              0.00000000,  # 1, 0
             -0.00148179,  # 1, 1
              #              a, b     irrep_a = 2
             -0.00374441,  # 0, 0
              0.00000000,  # 0, 1
              0.00000000,  # 1, 0
             -0.00148179,  # 1, 1
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)
        self.assertEqual(wf.n_irrep, 4)
        self.assertTrue(wf.restricted)

    def test_hcl_631g_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('HCl__1.5__631g__C2v'))
        my_ampl = np.array(
            # Singles:
            [# ----------    i, a    irrep = 0
             -0.00014166,  # 0, 0
             -0.00315634,  # 0, 1
              0.00174224,  # 0, 2
             -0.00075553,  # 0, 3
             -0.00087725,  # 1, 0
              0.00203402,  # 1, 1
              0.00606624,  # 1, 2
             -0.00102091,  # 1, 3
             # ----------    i, a    irrep = 1
              0.00731866,  # 0, 0
             # ----------    i, a    irrep = 2
              0.00731866,  # 0, 0
             # ==============================================
             # Doubles:
             # ====> pair ij = 0:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
             -0.00792707,  # 0, 0
              0.00309373,  # 0, 1
             -0.00187224,  # 0, 2
             -0.01071886,  # 0, 3
              0.00309373,  # 1, 0
             -0.01368087,  # 1, 1
              0.00048542,  # 1, 2
             -0.00421862,  # 1, 3
             -0.00187224,  # 2, 0
              0.00048542,  # 2, 1
             -0.00387597,  # 2, 2
             -0.00277093,  # 2, 3
             -0.01071886,  # 3, 0
             -0.00421862,  # 3, 1
             -0.00277093,  # 3, 2
             -0.02225884,  # 3, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00674917,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.00674917,  # 0, 0
             # ====> pair ij = 1:   (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
              0.00486590,  # 0, 0
             -0.00146212,  # 0, 1
             -0.00476326,  # 0, 2
              0.00669938,  # 0, 3
              0.00079211,  # 1, 0
              0.00963770,  # 1, 1
              0.00710552,  # 1, 2
              0.00844545,  # 1, 3
              0.00078957,  # 2, 0
              0.00209965,  # 2, 1
             -0.01024934,  # 2, 2
              0.00450950,  # 2, 3
              0.00697936,  # 3, 0
              0.00516810,  # 3, 1
             -0.00118494,  # 3, 2
              0.01544026,  # 3, 3
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 1)
             -0.00407663,  # 0, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 2)
             -0.00407663,  # 0, 0
             # ====> pair ij = 2:  (i = 1, i_irrep 0); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0
             -0.02275450,  # 0, 0
             -0.00720109,  # 0, 1
              0.00303153,  # 0, 2
             -0.01575975,  # 0, 3
             -0.00720109,  # 1, 0
             -0.00989622,  # 1, 1
             -0.00111353,  # 1, 2
             -0.01084226,  # 1, 3
              0.00303153,  # 2, 0
             -0.00111353,  # 2, 1
             -0.03064355,  # 2, 2
              0.00877140,  # 2, 3
             -0.01575975,  # 3, 0
             -0.01084226,  # 3, 1
              0.00877140,  # 3, 2
             -0.02266788,  # 3, 3
             # ----------    a, b     irrep_a = 1
             -0.00550082,  # 0, 0
             # ----------    a, b     irrep_a = 2
             -0.00550082,  # 0, 0
             # ====> pair ij = 3:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00985632,  # 0, 0
              0.01210219,  # 1, 0
             -0.00917792,  # 2, 0
             -0.00813465,  # 3, 0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
             -0.00652416,  # 0, 0
              0.00208640,  # 0, 1
             -0.00496870,  # 0, 2
             -0.00674374,  # 0, 3
             # ====> pair ij = 4:  (i = 1, i_irrep =  0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (irrep_b = 1)
              0.00036483,  # 0, 0
             -0.00344245,  # 1, 0
             -0.02430901,  # 2, 0
              0.00272304,  # 3, 0
             # ----------    a, b     irrep_a = 1  (irrep_b = 0)
             -0.00211533,  # 0, 0
              0.00104057,  # 0, 1
             -0.00917737,  # 0, 2
             -0.00049167,  # 0, 3
             # ====> pair ij = 5:  (i = 0, i_irrep = 1); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (irrep_b = 0)
             -0.00911375,  # 0, 0
             -0.00396353,  # 0, 1
             -0.00069415,  # 0, 2
             -0.00610306,  # 0, 3
             -0.00396353,  # 1, 0
             -0.01256441,  # 1, 1
              0.00717613,  # 1, 2
             -0.00086672,  # 1, 3
             -0.00069415,  # 2, 0
              0.00717613,  # 2, 1
             -0.01074585,  # 2, 2
             -0.00125227,  # 2, 3
             -0.00610306,  # 3, 0
             -0.00086672,  # 3, 1
             -0.00125227,  # 3, 2
             -0.00575189,  # 3, 3
             # ----------    a, b     irrep_a = 1  (irrep_b = 1)
             -0.04065767,  # 0, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 2)
             -0.00384435,  # 0, 0
             # ====> pair ij = 6:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
             -0.00985632,  # 0, 0
              0.01210219,  # 1, 0
             -0.00917792,  # 2, 0
             -0.00813465,  # 3, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 0)
             -0.00652416,  # 0, 0
              0.00208640,  # 0, 1
             -0.00496870,  # 0, 2
             -0.00674374,  # 0, 3
             # ====> pair ij = 7: (i = 1, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (irrep_b = 2)
              0.00036483,  # 0, 0
             -0.00344245,  # 1, 0
             -0.02430901,  # 2, 0
              0.00272304,  # 3, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 0)
             -0.00211533,  # 0, 0
              0.00104057,  # 0, 1
             -0.00917737,  # 0, 2
             -0.00049167,  # 0, 3
             # ====> pair ij = 8: (i = 0, i_irrep = 1);  (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 2)
             -0.02889921,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
             -0.00791411,  # 0, 0
             # ====> pair ij = 9: (i = 0, i_irrep = 2); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.00911375,  # 0, 0
             -0.00396353,  # 0, 1
             -0.00069415,  # 0, 2
             -0.00610306,  # 0, 3
             -0.00396353,  # 1, 0
             -0.01256441,  # 1, 1
              0.00717613,  # 1, 2
             -0.00086672,  # 1, 3
             -0.00069415,  # 2, 0
              0.00717613,  # 2, 1
             -0.01074585,  # 2, 2
             -0.00125227,  # 2, 3
             -0.00610306,  # 3, 0
             -0.00086672,  # 3, 1
             -0.00125227,  # 3, 2
             -0.00575189,  # 3, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00384435,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.04065767   # 0, 0
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)
    
    def test_hcl_plus_631g_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('HCl_plus__1.5__631g__C2v'))
        my_ampl = np.array(
            # Singles:
            [# alpha -> alpha
             # ----------    i, a    irrep = 0
              0.01784805,  # 0, 0
              0.00830479,  # 0, 1
             -0.00803180,  # 0, 2
              0.01852627,  # 0, 3
             -0.00135112,  # 1, 0
              0.00081741,  # 1, 1
              0.00294875,  # 1, 2
             -0.00439943,  # 1, 3
             # ----------    i, a    irrep = 1
             -0.00232514,  # 0, 0
             # ----------    i, a    irrep = 2
             -0.00232514,  # 0, 0
             # beta -> beta
             # ----------    i, a    irrep = 0
              0.00958290,  # 0, 0
             -0.01382469,  # 0, 1
             -0.01094433,  # 0, 2
              0.00815319,  # 0, 3
             -0.01471423,  # 0, 5
             # ----------    i, a    irrep = 1
              0.01706957,  # 0, 0
             # ----------    i, a    irrep = 2
              0.01706957,  # 0, 0
             # ==============================================
             # Doubles:
             # alpha,alpha -> alpha,alpha
             # ====> pair ij = 0:   (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
              0.00000000,  # 0, 0
             -0.00185862,  # 0, 1
             -0.00410708,  # 0, 2
              0.00093532,  # 0, 3
              0.00185862,  # 1, 0
             -0.00000000,  # 1, 1
              0.00458857,  # 1, 2
              0.00204848,  # 1, 3
              0.00410708,  # 2, 0
             -0.00458857,  # 2, 1
             -0.00000000,  # 2, 2
              0.00470146,  # 2, 3
             -0.00093532,  # 3, 0
             -0.00204848,  # 3, 1
             -0.00470146,  # 3, 2
             -0.00000000,  # 3, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
              0.00000000,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
              0.00000000,  # 0, 0
             # ====> pair ij = 1:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00245781,  # 0, 0
              0.00851271,  # 0, 1
             -0.00317859,  # 0, 2
             -0.00160909,  # 0, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.00245781,  # 0, 0
             -0.00851271,  # 1, 0
              0.00317859,  # 2, 0
              0.00160909,  # 3, 0
             # ====> pair ij = 2:   (i = 1, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
              0.00032344,  # 0, 0
             -0.00319323,  # 0, 1
             -0.01318522,  # 0, 2
              0.00312449,  # 0, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
             -0.00032344,  # 0, 0
              0.00319323,  # 1, 0
              0.01318522,  # 2, 0
             -0.00312449,  # 3, 0
             # ====> pair ij = 3:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
             -0.00245781,  # 0, 0
              0.00851271,  # 0, 1
             -0.00317859,  # 0, 2
             -0.00160909,  # 0, 3
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
              0.00245781,  # 0, 0
             -0.00851271,  # 1, 0
              0.00317859,  # 2, 0
              0.00160909,  # 3, 0
             # ====> pair ij = 4:   (i = 1, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
              0.00032344,  # 0, 0
             -0.00319323,  # 0, 1
             -0.01318522,  # 0, 2
              0.00312449,  # 0, 3
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
             -0.00032344,  # 0, 0
              0.00319323,  # 1, 0
              0.01318522,  # 2, 0
             -0.00312449,  # 3, 0
             # ====> pair ij = 5:   (i = 0, i_irrep = 1); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 2)
             -0.01787448,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 1)
              0.01787448,  # 0, 0
             # beta,beta -> beta,beta
             # ====> pair ij = 6:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00599544,  # 0, 0
             -0.00182103,  # 0, 1
              0.00931941,  # 0, 2
             -0.00340175,  # 0, 3
             -0.00186764,  # 0, 4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.00599544,  # 0, 0
              0.00182103,  # 1, 0
             -0.00931941,  # 2, 0
              0.00340175,  # 3, 0
              0.00186764,  # 4, 0
             # ====> pair ij = 7:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00599544,  # 0, 0
             -0.00182103,  # 0, 1
              0.00931941,  # 0, 2
             -0.00340175,  # 0, 3
             -0.00186764,  # 0, 4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.00599544,  # 0, 0
              0.00182103,  # 1, 0
             -0.00931941,  # 2, 0
              0.00340175,  # 3, 0
              0.00186764,  # 4, 0
             # ====> pair ij = 8:   (i = 0, i_irrep = 1); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 2)
             -0.01888335,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 1)
              0.01888335,  # 0, 0
             # alpha,beta -> alpha,beta
             # ====> pair ij = 9:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.01040549,  # 0, 0
             -0.01082775,  # 0, 1
              0.00074585,  # 0, 2
              0.00008689,  # 0, 3
             -0.01434188,  # 0, 4
              0.01264477,  # 1, 0
             -0.00006409,  # 1, 1
             -0.01304051,  # 1, 2
              0.00108684,  # 1, 3
             -0.00361534,  # 1, 4
              0.00570174,  # 2, 0
             -0.00014829,  # 2, 1
              0.00077905,  # 2, 2
             -0.00290351,  # 2, 3
             -0.00000741,  # 2, 4
              0.01885835,  # 3, 0
             -0.01398380,  # 3, 1
             -0.00329637,  # 3, 2
              0.00022332,  # 3, 3
             -0.02257707,  # 3, 4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00504730,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.00504730,  # 0, 0
             # ====> pair ij = 10:   (i = 1, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.03124254,  # 0, 0
              0.00506846,  # 0, 1
              0.00269563,  # 0, 2
             -0.00023777,  # 0, 3
              0.00696701,  # 0, 4
             -0.01906441,  # 1, 0
              0.00083530,  # 1, 1
              0.00754846,  # 1, 2
              0.00155938,  # 1, 3
              0.00371387,  # 1, 4
              0.01609830,  # 2, 0
             -0.00438010,  # 2, 1
              0.00611681,  # 2, 2
             -0.00725038,  # 2, 3
             -0.00324607,  # 2, 4
             -0.03305315,  # 3, 0
              0.00788073,  # 3, 1
              0.00571272,  # 3, 2
              0.00142515,  # 3, 3
              0.01270294,  # 3, 4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00320008,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.00320008,  # 0, 0
             # ====> pair ij = 11:   (i = 0, i_irrep = 1); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00620254,  # 0, 0
              0.00243941,  # 1, 0
             -0.00315527,  # 2, 0
             -0.00662562,  # 3, 0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.00492964,  # 0, 0
             -0.00763695,  # 0, 1
              0.01161329,  # 0, 2
             -0.00650954,  # 0, 3
             -0.00802549,  # 0, 4
             # ====> pair ij = 12:   (i = 0, i_irrep = 2); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
             -0.00620254,  # 0, 0
              0.00243941,  # 1, 0
             -0.00315527,  # 2, 0
             -0.00662562,  # 3, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
              0.00492964,  # 0, 0
             -0.00763695,  # 0, 1
              0.01161329,  # 0, 2
             -0.00650954,  # 0, 3
             -0.00802549,  # 0, 4
             # ====> pair ij = 13:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00877416,  # 0, 0
              0.01069290,  # 1, 0
             -0.00615560,  # 2, 0
             -0.00820397,  # 3, 0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.01078515,  # 0, 0
             -0.00523606,  # 0, 1
              0.00246647,  # 0, 2
             -0.00327658,  # 0, 3
             -0.00540235,  # 0, 4
             # ====> pair ij = 14:   (i = 1, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00129085,  # 0, 0
             -0.00207164,  # 1, 0
             -0.01993592,  # 2, 0
              0.00292524,  # 3, 0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.01899016,  # 0, 0
             -0.00166252,  # 0, 1
              0.00111767,  # 0, 2
             -0.00675456,  # 0, 3
             -0.00026334,  # 0, 4
             # ====> pair ij = 15:   (i = 0, i_irrep = 1); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.02353907,  # 0, 0
             -0.01067318,  # 0, 1
             -0.00341709,  # 0, 2
              0.00008884,  # 0, 3
             -0.00626447,  # 0, 4
              0.00803844,  # 1, 0
             -0.00349113,  # 1, 1
             -0.00894336,  # 1, 2
              0.00569302,  # 1, 3
              0.00022746,  # 1, 4
              0.00427690,  # 2, 0
              0.00014090,  # 2, 1
              0.00604549,  # 2, 2
             -0.00874597,  # 2, 3
             -0.00073746,  # 2, 4
              0.00426871,  # 3, 0
             -0.00636713,  # 3, 1
              0.00026795,  # 3, 2
             -0.00036740,  # 3, 3
             -0.00563170,  # 3, 4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.03355893,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.00322050,  # 0, 0
             # ====> pair ij = 16:   (i = 0, i_irrep = 2); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 2)
             -0.00608946,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 1)
             -0.02424898,  # 0, 0
             # ====> pair ij = 17:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
             -0.00877416,  # 0, 0
              0.01069290,  # 1, 0
             -0.00615560,  # 2, 0
             -0.00820397,  # 3, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
              0.01078515,  # 0, 0
             -0.00523606,  # 0, 1
              0.00246647,  # 0, 2
             -0.00327658,  # 0, 3
             -0.00540235,  # 0, 4
             # ====> pair ij = 18:   (i = 1, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
             -0.00129085,  # 0, 0
             -0.00207164,  # 1, 0
             -0.01993592,  # 2, 0
              0.00292524,  # 3, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
              0.01899016,  # 0, 0
             -0.00166252,  # 0, 1
              0.00111767,  # 0, 2
             -0.00675456,  # 0, 3
             -0.00026334,  # 0, 4
             # ====> pair ij = 19:   (i = 0, i_irrep = 1); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 2)
             -0.02424898,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 1)
             -0.00608946,  # 0, 0
             # ====> pair ij = 20:   (i = 0, i_irrep = 2); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.02353907,  # 0, 0
             -0.01067318,  # 0, 1
             -0.00341709,  # 0, 2
              0.00008884,  # 0, 3
             -0.00626447,  # 0, 4
              0.00803844,  # 1, 0
             -0.00349113,  # 1, 1
             -0.00894336,  # 1, 2
              0.00569302,  # 1, 3
              0.00022746,  # 1, 4
              0.00427690,  # 2, 0
              0.00014090,  # 2, 1
              0.00604549,  # 2, 2
             -0.00874597,  # 2, 3
             -0.00073746,  # 2, 4
              0.00426871,  # 3, 0
             -0.00636713,  # 3, 1
              0.00026795,  # 3, 2
             -0.00036740,  # 3, 3
             -0.00563170,  # 3, 4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00322050,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.03355893   # 0, 0
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)
        self.assertEqual(wf.n_irrep, 4)
        self.assertFalse(wf.restricted)

    def test_hcl_plus_631g_cs(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('HCl_plus__1.5__631g__Cs'))
        my_ampl = np.array(
            # Singles:
            [# alpha -> alpha
             # ----------    i,a    irrep = 0
             -0.01067460,  # 0,0
             -0.00565161,  # 0,1
              0.00000000,  # 0,2
             -0.00020074,  # 0,3
             -0.00860819,  # 0,4
             -0.00571743,  # 1,0
             -0.00148761,  # 1,1
              0.00000000,  # 1,2
              0.00087046,  # 1,3
             -0.00207817,  # 1,4
             -0.00000000,  # 2,0
              0.00000000,  # 2,1
              0.00563342,  # 2,2
             -0.00000000,  # 2,3
             -0.00000000,  # 2,4
             # ----------    i,a    irrep = 1
              0.00071122,  # 0,0
             # beta -> beta
             # ----------    i,a    irrep = 0
             -0.00000000,  # 0,0
              0.01050165,  # 0,1
              0.00184773,  # 0,2
              0.00000000,  # 0,3
              0.00273442,  # 0,4
              0.00763838,  # 0,5
              0.00000000,  # 1,0
              0.00531359,  # 1,1
              0.00348828,  # 1,2
              0.00000000,  # 1,3
              0.00931950,  # 1,4
             -0.00070203,  # 1,5
             # ----------    i,a    irrep = 1
              0.01314213,  # 0,0
             # ==============================================
             # Doubles:
             # alpha,alpha -> alpha,alpha
             # ====> pair ij = 0:    (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a,b     irrep_a = 0  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.00146393,  # 0,1
             -0.00000000,  # 0,2
             -0.00520613,  # 0,3
              0.00009254,  # 0,4
              0.00146393,  # 1,0
             -0.00000000,  # 1,1
              0.00000000,  # 1,2
              0.00483582,  # 1,3
              0.00222521,  # 1,4
              0.00000000,  # 2,0
             -0.00000000,  # 2,1
              0.00000000,  # 2,2
             -0.00000000,  # 2,3
              0.00000000,  # 2,4
              0.00520613,  # 3,0
             -0.00483582,  # 3,1
              0.00000000,  # 3,2
              0.00000000,  # 3,3
              0.00560281,  # 3,4
             -0.00009254,  # 4,0
             -0.00222521,  # 4,1
             -0.00000000,  # 4,2
             -0.00560281,  # 4,3
              0.00000000,  # 4,4
             # ----------    a,b     irrep_a = 1  (=> irrep_b = 1)
              0.00000000,  # 0,0
             # ====> pair ij = 1:    (i = 0, i_irrep = 0); (j = 2, j_irrep = 0)
             # ----------    a,b     irrep_a = 0  (=> irrep_b = 0)
              0.00000000,  # 0,0
              0.00000000,  # 0,1
             -0.00336582,  # 0,2
              0.00000000,  # 0,3
             -0.00000000,  # 0,4
             -0.00000000,  # 1,0
              0.00000000,  # 1,1
              0.00855431,  # 1,2
             -0.00000000,  # 1,3
             -0.00000000,  # 1,4
              0.00336582,  # 2,0
             -0.00855431,  # 2,1
              0.00000000,  # 2,2
              0.00275242,  # 2,3
              0.00212508,  # 2,4
             -0.00000000,  # 3,0
              0.00000000,  # 3,1
             -0.00275242,  # 3,2
              0.00000000,  # 3,3
             -0.00000000,  # 3,4
              0.00000000,  # 4,0
              0.00000000,  # 4,1
             -0.00212508,  # 4,2
              0.00000000,  # 4,3
             -0.00000000,  # 4,4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
              0.00000000,  # 0,0
             # ====> pair ij = 2:    (i = 1, i_irrep = 0); (j = 2, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.00000000,  # 0,1
              0.00166283,  # 0,2
             -0.00000000,  # 0,3
              0.00000000,  # 0,4
              0.00000000,  # 1,0
             -0.00000000,  # 1,1
             -0.00249411,  # 1,2
              0.00000000,  # 1,3
              0.00000000,  # 1,4
             -0.00166283,  # 2,0
              0.00249411,  # 2,1
             -0.00000000,  # 2,2
              0.01365235,  # 2,3
             -0.00293447,  # 2,4
              0.00000000,  # 3,0
             -0.00000000,  # 3,1
             -0.01365235,  # 3,2
              0.00000000,  # 3,3
              0.00000000,  # 3,4
             -0.00000000,  # 4,0
             -0.00000000,  # 4,1
              0.00293447,  # 4,2
             -0.00000000,  # 4,3
             -0.00000000,  # 4,4
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
              0.00000000,  # 0,0
             # ====> pair ij = 3:    (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00287539,  # 0,0
              0.00906863,  # 1,0
             -0.00000000,  # 2,0
             -0.00277711,  # 3,0
             -0.00181779,  # 4,0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.00287539,  # 0,0
             -0.00906863,  # 0,1
              0.00000000,  # 0,2
              0.00277711,  # 0,3
              0.00181779,  # 0,4
             # ====> pair ij = 4:    (i = 1, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
              0.00211047,  # 0,0
             -0.00226025,  # 1,0
             -0.00000000,  # 2,0
             -0.01384767,  # 3,0
              0.00311665,  # 4,0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
             -0.00211047,  # 0,0
              0.00226025,  # 0,1
              0.00000000,  # 0,2
              0.01384767,  # 0,3
             -0.00311665,  # 0,4
             # ====> pair ij = 5:    (i = 2, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
              0.00000000,  # 0,0
              0.00000000,  # 1,0
             -0.01821880,  # 2,0
              0.00000000,  # 3,0
              0.00000000,  # 4,0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.00000000,  # 0,1
              0.01821880,  # 0,2
             -0.00000000,  # 0,3
             -0.00000000,  # 0,4
             # beta,beta -> beta,beta
             # ====> pair ij = 6:    (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.00000000,  # 0,0
              0.00000000,  # 0,1
             -0.00000000,  # 0,2
             -0.00165873,  # 0,3
              0.00000000,  # 0,4
              0.00000000,  # 0,5
             -0.00000000,  # 1,0
             -0.00000000,  # 1,1
             -0.00164276,  # 1,2
             -0.00000000,  # 1,3
             -0.00523261,  # 1,4
              0.00012316,  # 1,5
              0.00000000,  # 2,0
              0.00164276,  # 2,1
              0.00000000,  # 2,2
              0.00000000,  # 2,3
              0.00460091,  # 2,4
              0.00216699,  # 2,5
              0.00165873,  # 3,0
              0.00000000,  # 3,1
             -0.00000000,  # 3,2
              0.00000000,  # 3,3
              0.00000000,  # 3,4
              0.00000000,  # 3,5
             -0.00000000,  # 4,0
              0.00523261,  # 4,1
             -0.00460091,  # 4,2
             -0.00000000,  # 4,3
             -0.00000000,  # 4,4
              0.00536596,  # 4,5
             -0.00000000,  # 5,0
             -0.00012316,  # 5,1
             -0.00216699,  # 5,2
             -0.00000000,  # 5,3
             -0.00536596,  # 5,4
             -0.00000000,  # 5,5
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
              0.00000000,  # 0,0
             # ====> pair ij = 7:    (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00000000,  # 0,0
             -0.00287627,  # 1,0
              0.00902444,  # 2,0
             -0.00000000,  # 3,0
             -0.00289047,  # 4,0
             -0.00136393,  # 5,0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.00000000,  # 0,0
              0.00287627,  # 0,1
             -0.00902444,  # 0,2
              0.00000000,  # 0,3
              0.00289047,  # 0,4
              0.00136393,  # 0,5
             # ====> pair ij = 8:    (i = 1, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00000000,  # 0,0
              0.00200548,  # 1,0
             -0.00249476,  # 2,0
             -0.00000000,  # 3,0
             -0.01406007,  # 4,0
              0.00332141,  # 5,0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
              0.00000000,  # 0,0
             -0.00200548,  # 0,1
              0.00249476,  # 0,2
              0.00000000,  # 0,3
              0.01406007,  # 0,4
             -0.00332141,  # 0,5
             # alpha,beta -> alpha,beta
             # ====> pair ij = 9:    (i = 0, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.00000000,  # 0,0
             -0.00900496,  # 0,1
              0.00158446,  # 0,2
             -0.00000000,  # 0,3
             -0.00130810,  # 0,4
             -0.01215871,  # 0,5
              0.00000000,  # 1,0
              0.00197285,  # 1,1
             -0.01221113,  # 1,2
             -0.00000000,  # 1,3
              0.00001808,  # 1,4
             -0.00330663,  # 1,5
              0.01222252,  # 2,0
             -0.00000000,  # 2,1
              0.00000000,  # 2,2
             -0.00520129,  # 2,3
              0.00000000,  # 2,4
             -0.00000000,  # 2,5
             -0.00000000,  # 3,0
             -0.00122189,  # 3,1
              0.00003864,  # 3,2
              0.00000000,  # 3,3
             -0.00308000,  # 3,4
             -0.00213040,  # 3,5
             -0.00000000,  # 4,0
             -0.01212285,  # 4,1
             -0.00327915,  # 4,2
             -0.00000000,  # 4,3
             -0.00231244,  # 4,4
             -0.02161423,  # 4,5
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00521363,  # 0,0
             # ====> pair ij = 10:   (i = 1, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.00000000,  # 0,0
              0.00540321,  # 0,1
              0.00148293,  # 0,2
              0.00000000,  # 0,3
              0.00109648,  # 0,4
              0.00825149,  # 0,5
             -0.00000000,  # 1,0
             -0.00020982,  # 1,1
              0.00676158,  # 1,2
              0.00000000,  # 1,3
              0.00318000,  # 1,4
              0.00459778,  # 1,5
              0.00665946,  # 2,0
             -0.00000000,  # 2,1
              0.00000000,  # 2,2
             -0.00312678,  # 2,3
             -0.00000000,  # 2,4
              0.00000000,  # 2,5
             -0.00000000,  # 3,0
             -0.00438555,  # 3,1
              0.00762575,  # 3,2
             -0.00000000,  # 3,3
             -0.00790045,  # 3,4
             -0.00112856,  # 3,5
             -0.00000000,  # 4,0
              0.00813519,  # 4,1
              0.00691326,  # 4,2
              0.00000000,  # 4,3
              0.00437925,  # 4,4
              0.01544195,  # 4,5
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00320097,  # 0,0
             # ====> pair ij = 11:   (i = 2, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.02093340,  # 0,0
             -0.00000000,  # 0,1
              0.00000000,  # 0,2
             -0.00524625,  # 0,3
              0.00000000,  # 0,4
              0.00000000,  # 0,5
              0.00737417,  # 1,0
             -0.00000000,  # 1,1
              0.00000000,  # 1,2
              0.00205283,  # 1,3
             -0.00000000,  # 1,4
              0.00000000,  # 1,5
              0.00000000,  # 2,0
             -0.00866860,  # 2,1
              0.01060456,  # 2,2
             -0.00000000,  # 2,3
             -0.00633958,  # 2,4
             -0.00716738,  # 2,5
              0.00291943,  # 3,0
              0.00000000,  # 3,1
             -0.00000000,  # 3,2
             -0.00357943,  # 3,3
              0.00000000,  # 3,4
              0.00000000,  # 3,5
              0.01616362,  # 4,0
              0.00000000,  # 4,1
              0.00000000,  # 4,2
             -0.00496539,  # 4,3
              0.00000000,  # 4,4
              0.00000000,  # 4,5
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00000000,  # 0,0
             # ====> pair ij = 12:   (i = 0, i_irrep = 1); (j = 0, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 1)
             -0.00566620,  # 0,0
              0.00237044,  # 1,0
             -0.00000000,  # 2,0
             -0.00367240,  # 3,0
             -0.00588055,  # 4,0
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.00867864,  # 0,1
              0.01116092,  # 0,2
             -0.00000000,  # 0,3
             -0.00653743,  # 0,4
             -0.00724480,  # 0,5
             # ====> pair ij = 13:   (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.00000000,  # 0,0
              0.00532022,  # 0,1
             -0.00002179,  # 0,2
             -0.00000000,  # 0,3
             -0.00406668,  # 0,4
              0.00789040,  # 0,5
              0.00000000,  # 1,0
              0.00137334,  # 1,1
              0.00660659,  # 1,2
              0.00000000,  # 1,3
              0.00790447,  # 1,4
              0.00634778,  # 1,5
              0.00830215,  # 2,0
             -0.00000000,  # 2,1
              0.00000000,  # 2,2
             -0.00324694,  # 2,3
             -0.00000000,  # 2,4
              0.00000000,  # 2,5
             -0.00000000,  # 3,0
              0.00075479,  # 3,1
              0.00286984,  # 3,2
             -0.00000000,  # 3,3
             -0.00750414,  # 3,4
              0.00388973,  # 3,5
              0.00000000,  # 4,0
              0.00772133,  # 4,1
              0.00434249,  # 4,2
             -0.00000000,  # 4,3
             -0.00144152,  # 4,4
              0.01467173,  # 4,5
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00316188,  # 0,0
             # ====> pair ij = 14:   (i = 1, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.02205441,  # 0,1
             -0.00697193,  # 0,2
              0.00000000,  # 0,3
              0.00344046,  # 0,4
             -0.01685233,  # 0,5
             -0.00000000,  # 1,0
             -0.00691633,  # 1,1
             -0.00783153,  # 1,2
              0.00000000,  # 1,3
              0.00181680,  # 1,4
             -0.00993174,  # 1,5
              0.00932222,  # 2,0
              0.00000000,  # 2,1
              0.00000000,  # 2,2
             -0.00441694,  # 2,3
             -0.00000000,  # 2,4
              0.00000000,  # 2,5
             -0.00000000,  # 3,0
              0.00276688,  # 3,1
              0.00133225,  # 3,2
             -0.00000000,  # 3,3
             -0.02636719,  # 3,4
              0.00786716,  # 3,5
             -0.00000000,  # 4,0
             -0.01649872,  # 4,1
             -0.00980908,  # 4,2
              0.00000000,  # 4,3
              0.00797599,  # 4,4
             -0.02183699,  # 4,5
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00437109,  # 0,0
             # ====> pair ij = 15:   (i = 2, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
              0.01076037,  # 0,0
             -0.00000000,  # 0,1
             -0.00000000,  # 0,2
             -0.00184521,  # 0,3
              0.00000000,  # 0,4
             -0.00000000,  # 0,5
              0.00473848,  # 1,0
             -0.00000000,  # 1,1
             -0.00000000,  # 1,2
              0.00141837,  # 1,3
             -0.00000000,  # 1,4
             -0.00000000,  # 1,5
              0.00000000,  # 2,0
             -0.00018287,  # 2,1
             -0.00106007,  # 2,2
             -0.00000000,  # 2,3
             -0.02045261,  # 2,4
              0.00260056,  # 2,5
              0.00833729,  # 3,0
             -0.00000000,  # 3,1
              0.00000000,  # 3,2
             -0.00679320,  # 3,3
              0.00000000,  # 3,4
             -0.00000000,  # 3,5
              0.00130593,  # 4,0
             -0.00000000,  # 4,1
             -0.00000000,  # 4,2
             -0.00032608,  # 4,3
              0.00000000,  # 4,4
             -0.00000000,  # 4,5
             # ----------    a,b     irrep_a = 1  (=> irrep_b = 1)
             -0.00000000,  # 0,0
             # ====> pair ij = 16:   (i = 0, i_irrep = 1); (j = 1, j_irrep = 0)
             # ----------    a,b     irrep_a = 0  (=> irrep_b = 1)
             -0.00174274,  # 0,0
              0.00174859,  # 1,0
             -0.00000000,  # 2,0
             -0.00710270,  # 3,0
             -0.00046948,  # 4,0
             # ----------    a,b     irrep_a = 1  (=> irrep_b = 0)
             -0.00000000,  # 0,0
              0.00006818,  # 0,1
             -0.00082669,  # 0,2
             -0.00000000,  # 0,3
             -0.02095264,  # 0,4
              0.00275518,  # 0,5
             # ====> pair ij = 17:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a,b     irrep_a = 0  (=> irrep_b = 1)
             -0.00826111,  # 0,0
              0.01166520,  # 1,0
             -0.00000000,  # 2,0
             -0.00632008,  # 3,0
             -0.00757192,  # 4,0
             # ----------    a,b     irrep_a = 1  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.00579627,  # 0,1
              0.00226558,  # 0,2
             -0.00000000,  # 0,3
             -0.00355744,  # 0,4
             -0.00596611,  # 0,5
             # ====> pair ij = 18:   (i = 1, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a,b     irrep_a = 0  (=> irrep_b = 1)
              0.00066952,  # 0,0
             -0.00049627,  # 1,0
             -0.00000000,  # 2,0
             -0.02094249,  # 3,0
              0.00275330,  # 4,0
             # ----------    a,b     irrep_a = 1  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.00178172,  # 0,1
              0.00161658,  # 0,2
             -0.00000000,  # 0,3
             -0.00699241,  # 0,4
             -0.00048066,  # 0,5
             # ====> pair ij = 19:   (i = 2, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a,b     irrep_a = 0  (=> irrep_b = 1)
              0.00000000,  # 0,0
              0.00000000,  # 1,0
             -0.02399227,  # 2,0
              0.00000000,  # 3,0
              0.00000000,  # 4,0
             # ----------    a,b     irrep_a = 1  (=> irrep_b = 0)
              0.01232568,  # 0,0
             -0.00000000,  # 0,1
              0.00000000,  # 0,2
             -0.00573471,  # 0,3
              0.00000000,  # 0,4
             -0.00000000,  # 0,5
             # ====> pair ij = 20:   (i = 0, i_irrep = 1); (j = 0, j_irrep = 1)
             # ----------    a,b     irrep_a = 0  (=> irrep_b = 0)
             -0.00000000,  # 0,0
             -0.00916084,  # 0,1
             -0.00330270,  # 0,2
             -0.00000000,  # 0,3
             -0.00057430,  # 0,4
             -0.00626852,  # 0,5
             -0.00000000,  # 1,0
             -0.00328582,  # 1,1
             -0.01076669,  # 1,2
              0.00000000,  # 1,3
              0.00582230,  # 1,4
             -0.00039321,  # 1,5
              0.00619655,  # 2,0
             -0.00000000,  # 2,1
              0.00000000,  # 2,2
             -0.00311138,  # 2,3
             -0.00000000,  # 2,4
             -0.00000000,  # 2,5
             -0.00000000,  # 3,0
             -0.00057211,  # 3,1
              0.00583805,  # 3,2
             -0.00000000,  # 3,3
             -0.00778129,  # 3,4
             -0.00101458,  # 3,5
             -0.00000000,  # 4,0
             -0.00646989,  # 4,1
             -0.00047713,  # 4,2
             -0.00000000,  # 4,3
             -0.00104408,  # 4,4
             -0.00590674,  # 4,5
             # ----------    a,b     irrep_a = 1  (=> irrep_b = 1)
             -0.03364337,  # 0,0
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)
        self.assertEqual(wf.n_irrep, 2)
        self.assertFalse(wf.restricted)


@tests.category('SHORT')
class RestrictUnrestrictItTestCase(unittest.TestCase):

    def setUp(self):
        self.addTypeEqualityFunc(np.ndarray, tests.assert_arrays)

    def test_h2_sto3g_d2h(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('H2__5__sto3g__D2h'))
        self.assertTrue(wf.restricted)
        wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(wf.restricted)
        self.assertEqual(wf.get_amplitudes(), np.array([-0.86355553]))
        wf = IntermNormWaveFunction.restrict(wf)
        self.assertTrue(wf.restricted)
        self.assertEqual(wf.get_amplitudes(), np.array([-0.86355553]))

    def test_h2_631g_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('H2__5__631g__C2v'))
        self.assertTrue(wf.restricted)
        wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(wf.restricted)
        self.assertEqual(wf.get_amplitudes(), np.array(
            # Singles:
            [# alpha -> alpha
             #               i, a       irrep = 0
             -0.00000000,  # 0, 0
              0.07852602,  # 0, 1
             -0.00000000,  # 0, 2
             # beta -> beta
             #               i, a       irrep = 0
             -0.00000000,  # 0, 0
              0.07852602,  # 0, 1
             -0.00000000,  # 0, 2
             # ==============================================
             # Doubles:
             # alpha,beta -> alpha,beta
             # ---> pair ij = 0: (i, i_irrep) = (0, 0)   j, j_irrep = (0, 0)
             #               a, b     irrep_a = 0  (=> irrep_a = 0)
             -0.78356502,  # 0, 0
              0.00000000,  # 0, 1
             -0.07011574,  # 0, 2
              0.00000000,  # 1, 0
             -0.00272632,  # 1, 1
             -0.00000000,  # 1, 2
             -0.07011574,  # 2, 0
             -0.00000000,  # 2, 1
             -0.00808512,  # 2, 2
            ]))
        wf = IntermNormWaveFunction.restrict(wf)
        self.assertTrue(wf.restricted)
        self.assertEqual(wf.get_amplitudes(), np.array(
            # Singles:
            [#               i, a       irrep = 0
             -0.00000000,  # 0, 0
              0.07852602,  # 0, 1
             -0.00000000,  # 0, 2
             # ==============================================
             # Doubles:
             # ---> pair ij = 0: (i, i_irrep) = (0, 0)   j, j_irrep = (0, 0)
             #               a, b     irrep_a = 0
             -0.78356502,  # 0, 0
              0.00000000,  # 0, 1
             -0.07011574,  # 0, 2
              0.00000000,  # 1, 0
             -0.00272632,  # 1, 1
             -0.00000000,  # 1, 2
             -0.07011574,  # 2, 0
             -0.00000000,  # 2, 1
             -0.00808512,  # 2, 2
            ]))

    def test_h2_ccpvdz_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('H2__5__ccpVDZ__C2v'))
        self.assertTrue(wf.restricted)
        wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(wf.restricted)
        my_ampl = np.array(
            # Singles:
            [# alpha -> alpha
             #               i, a    irrep = 0
              0.00000000,  # 0, 0
             -0.10780149,  # 0, 1
              0.00000000,  # 0, 2
             -0.00566969,  # 0, 3
              0.00000000,  # 0, 4
             # beta -> beta
             #               i, a    irrep = 0
              0.00000000,  # 0, 0
             -0.10780149,  # 0, 1
              0.00000000,  # 0, 2
             -0.00566969,  # 0, 3
              0.00000000,  # 0, 4
             # ==============================================
             # Doubles:
             # alpha,beta -> alpha,beta
             # ---> pair ij = 0: (i, i_irrep) = (0, 0)   j, j_irrep = (0, 0)
             #              a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.76921165,  # 0, 0
             -0.00000000,  # 0, 1
              0.10150132,  # 0, 2
              0.00000000,  # 0, 3
             -0.00563809,  # 0, 4
             -0.00000000,  # 1, 0
             -0.00322314,  # 1, 1
             -0.00000000,  # 1, 2
              0.00021971,  # 1, 3
             -0.00000000,  # 1, 4
              0.10150132,  # 1, 0
             -0.00000000,  # 2, 1
             -0.01518971,  # 2, 2
             -0.00000000,  # 2, 3
              0.00068753,  # 2, 4
              0.00000000,  # 3, 0
              0.00021971,  # 3, 1
             -0.00000000,  # 3, 2
             -0.00549708,  # 3, 3
              0.00000000,  # 3, 4
             -0.00563809,  # 4, 0
             -0.00000000,  # 4, 1
              0.00068753,  # 4, 2
              0.00000000,  # 4, 3
             -0.00120278,  # 4, 4
             #              a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00374441,  # 0, 0
              0.00000000,  # 0, 1
              0.00000000,  # 1, 0
             -0.00148179,  # 1, 1
             #              a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.00374441,  # 0, 0
              0.00000000,  # 0, 1
              0.00000000,  # 1, 0
             -0.00148179,  # 1, 1
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)
        wf = IntermNormWaveFunction.restrict(wf)
        self.assertTrue(wf.restricted)
        my_ampl = np.array(
            # Singles:
            [#               i, a    irrep = 0
              0.00000000,  # 0, 0
             -0.10780149,  # 0, 1
              0.00000000,  # 0, 2
             -0.00566969,  # 0, 3
              0.00000000,  # 0, 4
              # ==============================================
              # Doubles:
              # ---> pair ij = 0: (i, i_irrep) = (0, 0)   j, j_irrep = (0, 0)
              #              a, b     irrep_a = 0
             -0.76921165,  # 0, 0
             -0.00000000,  # 0, 1
              0.10150132,  # 0, 2
              0.00000000,  # 0, 3
             -0.00563809,  # 0, 4
             -0.00000000,  # 1, 0
             -0.00322314,  # 1, 1
             -0.00000000,  # 1, 2
              0.00021971,  # 1, 3
             -0.00000000,  # 1, 4
              0.10150132,  # 1, 0
             -0.00000000,  # 2, 1
             -0.01518971,  # 2, 2
             -0.00000000,  # 2, 3
              0.00068753,  # 2, 4
              0.00000000,  # 3, 0
              0.00021971,  # 3, 1
             -0.00000000,  # 3, 2
             -0.00549708,  # 3, 3
              0.00000000,  # 3, 4
             -0.00563809,  # 4, 0
             -0.00000000,  # 4, 1
              0.00068753,  # 4, 2
              0.00000000,  # 4, 3
             -0.00120278,  # 4, 4
              #              a, b     irrep_a = 1
             -0.00374441,  # 0, 0
              0.00000000,  # 0, 1
              0.00000000,  # 1, 0
             -0.00148179,  # 1, 1
              #              a, b     irrep_a = 2
             -0.00374441,  # 0, 0
              0.00000000,  # 0, 1
              0.00000000,  # 1, 0
             -0.00148179,  # 1, 1
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)

    def test_hcl_631g_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('HCl__1.5__631g__C2v'))
        self.assertTrue(wf.restricted)
        wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(wf.restricted)
        my_ampl = np.array(
            # Singles:
            [# alpha -> alpha
             # ----------    i, a    irrep = 0
             -0.00014166,  # 0, 0
             -0.00315634,  # 0, 1
              0.00174224,  # 0, 2
             -0.00075553,  # 0, 3
             -0.00087725,  # 1, 0
              0.00203402,  # 1, 1
              0.00606624,  # 1, 2
             -0.00102091,  # 1, 3
             # ----------    i, a    irrep = 1
              0.00731866,  # 0, 0
             # ----------    i, a    irrep = 2
              0.00731866,  # 0, 0
             # beta -> beta
             # ----------    i, a    irrep = 0
             -0.00014166,  # 0, 0
             -0.00315634,  # 0, 1
              0.00174224,  # 0, 2
             -0.00075553,  # 0, 3
             -0.00087725,  # 1, 0
              0.00203402,  # 1, 1
              0.00606624,  # 1, 2
             -0.00102091,  # 1, 3
             # ----------    i, a    irrep = 1
              0.00731866,  # 0, 0
             # ----------    i, a    irrep = 2
              0.00731866,  # 0, 0
             # ==============================================
             # Doubles:
             # alpha,alpha -> alpha,alpha
             # ====> pair ij = 0:  (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b   irrep_a = 0  (=> irrep_b = 0)
              0.00000000,  # 0, 0
             -0.00225423,  # 0, 1
             -0.00555283,  # 0, 2
             -0.00027998,  # 0, 3
              0.00225423,  # 1, 0
              0.00000000,  # 1, 1
              0.00500587,  # 1, 2
              0.00327735,  # 1, 3
              0.00555283,  # 2, 0
             -0.00500587,  # 2, 1
              0.00000000,  # 2, 2
              0.00569444,  # 2, 3
              0.00027998,  # 3, 0
             -0.00327735,  # 3, 1
             -0.00569444,  # 3, 2
              0.00000000,  # 3, 3
             # ----------    a, b   irrep_a = 1  (=> irrep_b = 1)
              0.00000000,  # 0, 0
             # ----------    a, b   irrep_a = 2  (=> irrep_b = 2)
              0.000000000,  # 0, 0
             # ====> pair ij = 1:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b   irrep_a = 0
             -0.00333216,  # 0, 0
              0.01001579,  # 1, 0
             -0.00420922,  # 2, 0
             -0.00139091,  # 3, 0
             # ----------    a, b   irrep_a = 1
              0.00333216,  # 0, 0
             -0.01001579,  # 0, 1
              0.00420922,  # 0, 2
              0.00139091,  # 0, 3
             # ====> pair ij = 2:  (i = 1, i_irrep =  0); (j = 0, j_irrep = 1)
             # ----------    a, b   irrep_a = 0  (irrep_b = 1)
              0.00248016,  # 0, 0
             -0.00448302,  # 1, 0
             -0.01513164,  # 2, 0
              0.00321471,  # 3, 0
             # ----------    a, b   irrep_a = 1  (irrep_b = 0)
             -0.00248016,  # 0, 0
              0.00448302,  # 0, 1
              0.01513164,  # 0, 2
             -0.00321471,  # 0, 3
             # ====> pair ij = 3:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b   irrep_a = 0  (=> irrep_b = 2)
             -0.00333216,  # 0, 0
              0.01001579,  # 1, 0
             -0.00420922,  # 2, 0
             -0.00139091,  # 3, 0
             # ----------    a, b   irrep_a = 2  (irrep_b = 0)
              0.00333216,  # 0, 0
             -0.01001579,  # 0, 1
              0.00420922,  # 0, 2
              0.00139091,  # 0, 3
             # ====> pair ij = 4:  (i = 1, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b   irrep_a = 0  (irrep_b = 2)
              0.00248016,  # 0, 0
             -0.00448302,  # 1, 0
             -0.01513164,  # 2, 0
              0.00321471,  # 3, 0
             # ----------    a, b   irrep_a = 2  (irrep_b = 0)
             -0.00248016,  # 0, 0
              0.00448302,  # 0, 1
              0.01513164,  # 0, 2
             -0.00321471,  # 0, 3
             # ====> pair ij = 5:  (i = 0, i_irrep = 1);  (j = 0, j_irrep = 2)
             # ----------    a, b   irrep_a = 1  (=> irrep_b = 2)
             -0.02098510,  # 0, 0
             # ----------    a, b   irrep_a = 2  (=> irrep_b = 0)
             0.02098510,  # 0, 0
             # beta,beta -> beta,beta
             # ====> pair ij = 6:  (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b   irrep_a = 0  (=> irrep_b = 0)
              0.00000000,  # 0, 0
             -0.00225423,  # 0, 1
             -0.00555283,  # 0, 2
             -0.00027998,  # 0, 3
              0.00225423,  # 1, 0
              0.00000000,  # 1, 1
              0.00500587,  # 1, 2
              0.00327735,  # 1, 3
              0.00555283,  # 2, 0
             -0.00500587,  # 2, 1
              0.00000000,  # 2, 2
              0.00569444,  # 2, 3
              0.00027998,  # 3, 0
             -0.00327735,  # 3, 1
             -0.00569444,  # 3, 2
              0.00000000,  # 3, 3
             # ----------    a, b   irrep_a = 1  (=> irrep_b = 1)
              0.00000000,  # 0, 0
             # ----------    a, b   irrep_a = 2  (=> irrep_b = 2)
              0.000000000, # 0, 0
             # ====> pair ij = 7:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b   irrep_a = 0
             -0.00333216,  # 0, 0
              0.01001579,  # 1, 0
             -0.00420922,  # 2, 0
             -0.00139091,  # 3, 0
             # ----------    a, b   irrep_a = 1
              0.00333216,  # 0, 0
             -0.01001579,  # 0, 1
              0.00420922,  # 0, 2
              0.00139091,  # 0, 3
             # ====> pair ij = 8:  (i = 1, i_irrep =  0); (j = 0, j_irrep = 1)
             # ----------    a, b   irrep_a = 0  (irrep_b = 1)
              0.00248016,  # 0, 0
             -0.00448302,  # 1, 0
             -0.01513164,  # 2, 0
              0.00321471,  # 3, 0
             # ----------    a, b   irrep_a = 1  (irrep_b = 0)
             -0.00248016,  # 0, 0
              0.00448302,  # 0, 1
              0.01513164,  # 0, 2
             -0.00321471,  # 0, 3
             # ====> pair ij = 9:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b   irrep_a = 0  (=> irrep_b = 2)
             -0.00333216,  # 0, 0
              0.01001579,  # 1, 0
             -0.00420922,  # 2, 0
             -0.00139091,  # 3, 0
             # ----------    a, b   irrep_a = 2  (irrep_b = 0)
              0.00333216,  # 0, 0
             -0.01001579,  # 0, 1
              0.00420922,  # 0, 2
              0.00139091,  # 0, 3
             # ====> pair ij = 10:  (i = 1, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b   irrep_a = 0  (irrep_b = 2)
              0.00248016,  # 0, 0
             -0.00448302,  # 1, 0
             -0.01513164,  # 2, 0
              0.00321471,  # 3, 0
             # ----------    a, b   irrep_a = 2  (irrep_b = 0)
             -0.00248016,  # 0, 0
              0.00448302,  # 0, 1
              0.01513164,  # 0, 2
             -0.00321471,  # 0, 3
             # ====> pair ij = 11:  (i = 0, i_irrep = 1);  (j = 0, j_irrep = 2)
             # ----------    a, b   irrep_a = 1  (=> irrep_b = 2)
             -0.02098510,  # 0, 0
             # ----------    a, b   irrep_a = 2  (=> irrep_b = 0)
             0.02098510,   # 0, 0
             # alpha,beta -> alpha,beta
             # ====> pair ij = 12:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
             -0.00792707,  # 0, 0
              0.00309373,  # 0, 1
             -0.00187224,  # 0, 2
             -0.01071886,  # 0, 3
              0.00309373,  # 1, 0
             -0.01368087,  # 1, 1
              0.00048542,  # 1, 2
             -0.00421862,  # 1, 3
             -0.00187224,  # 2, 0
              0.00048542,  # 2, 1
             -0.00387597,  # 2, 2
             -0.00277093,  # 2, 3
             -0.01071886,  # 3, 0
             -0.00421862,  # 3, 1
             -0.00277093,  # 3, 2
             -0.02225884,  # 3, 3
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 1)
             -0.00674917,  # 0, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 2)
             -0.00674917,  # 0, 0
             # ====> pair ij = 13:  (i = 1, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
              0.00486590,  # 0, 0
              0.00079211,  # 0, 1
              0.00078957,  # 0, 2
              0.00697936,  # 0, 3
             -0.00146212,  # 1, 0
              0.00963770,  # 1, 1
              0.00209965,  # 1, 2
              0.00516810,  # 1, 3
             -0.00476326,  # 2, 0
              0.00710552,  # 2, 1
             -0.01024934,  # 2, 2
             -0.00118494,  # 2, 3
              0.00669938,  # 3, 0
              0.00844545,  # 3, 1
              0.00450950,  # 3, 2
              0.01544026,  # 3, 3
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 1)
             -0.00407663,  # 0, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 2)
             -0.00407663,  # 0, 0
             # ====> pair ij = 14:  (i = 0, i_irrep 1); (j = 0, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 1)
             -0.00652416,  # 0, 0
              0.00208640,  # 1, 0
             -0.00496870,  # 2, 0
             -0.00674374,  # 3, 0
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 0)
             -0.00985632,  # 0, 0
              0.01210219,  # 0, 1
             -0.00917792,  # 0, 2
             -0.00813465,  # 0, 3
             # ====> pair ij = 15:  (i = 0, i_irrep 2); (j = 0, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 2)
             -0.00652416,  # 0, 0
              0.00208640,  # 1, 0
             -0.00496870,  # 2, 0
             -0.00674374,  # 3, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 0)
             -0.00985632,  # 0, 0
              0.01210219,  # 0, 1
             -0.00917792,  # 0, 2
             -0.00813465,  # 0, 3
             # ====> pair ij = 16:  (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
              0.00486590,  # 0, 0
             -0.00146212,  # 0, 1
             -0.00476326,  # 0, 2
              0.00669938,  # 0, 3
              0.00079211,  # 1, 0
              0.00963770,  # 1, 1
              0.00710552,  # 1, 2
              0.00844545,  # 1, 3
              0.00078957,  # 2, 0
              0.00209965,  # 2, 1
             -0.01024934,  # 2, 2
              0.00450950,  # 2, 3
              0.00697936,  # 3, 0
              0.00516810,  # 3, 1
             -0.00118494,  # 3, 2
              0.01544026,  # 3, 3
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 1)
             -0.00407663,  # 0, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 2)
             -0.00407663,  # 0, 0
             # ====> pair ij = 17:  (i = 1, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0
             -0.02275450,  # 0, 0
             -0.00720109,  # 0, 1
              0.00303153,  # 0, 2
             -0.01575975,  # 0, 3
             -0.00720109,  # 1, 0
             -0.00989622,  # 1, 1
             -0.00111353,  # 1, 2
             -0.01084226,  # 1, 3
              0.00303153,  # 2, 0
             -0.00111353,  # 2, 1
             -0.03064355,  # 2, 2
              0.00877140,  # 2, 3
             -0.01575975,  # 3, 0
             -0.01084226,  # 3, 1
              0.00877140,  # 3, 2
             -0.02266788,  # 3, 3
             # ----------    a, b     irrep_a = 1
             -0.00550082,  # 0, 0
             # ----------    a, b     irrep_a = 2
             -0.00550082,  # 0, 0
             # ====> pair ij = 18:  (i = 0, i_irrep = 1); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 1)
             -0.00211533,  # 0, 0
              0.00104057,  # 1, 0
             -0.00917737,  # 2, 0
             -0.00049167,  # 3, 0
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 0)
              0.00036483,  # 0, 0
             -0.00344245,  # 0, 1
             -0.02430901,  # 0, 2
              0.00272304,  # 0, 3
             # ====> pair ij = 19:  (i = 0, i_irrep = 2); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 2)
             -0.00211533,  # 0, 0
              0.00104057,  # 1, 0
             -0.00917737,  # 2, 0
             -0.00049167,  # 3, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 0)
              0.00036483,  # 0, 0
             -0.00344245,  # 0, 1
             -0.02430901,  # 0, 2
              0.00272304,  # 0, 3
             # ====> pair ij = 20:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0
             -0.00985632,  # 0, 0
              0.01210219,  # 1, 0
             -0.00917792,  # 2, 0
             -0.00813465,  # 3, 0
             # ----------    a, b     irrep_a = 1
             -0.00652416,  # 0, 0
              0.00208640,  # 0, 1
             -0.00496870,  # 0, 2
             -0.00674374,  # 0, 3
             # ====> pair ij = 21:  (i = 1, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (irrep_b = 1)
              0.00036483,  # 0, 0
             -0.00344245,  # 1, 0
             -0.02430901,  # 2, 0
              0.00272304,  # 3, 0
             # ----------    a, b     irrep_a = 1  (irrep_b = 0)
             -0.00211533,  # 0, 0
              0.00104057,  # 0, 1
             -0.00917737,  # 0, 2
             -0.00049167,  # 0, 3
             # ====> pair ij = 22:  (i = 0, i_irrep = 1); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (irrep_b = 0)
             -0.00911375,  # 0, 0
             -0.00396353,  # 0, 1
             -0.00069415,  # 0, 2
             -0.00610306,  # 0, 3
             -0.00396353,  # 1, 0
             -0.01256441,  # 1, 1
              0.00717613,  # 1, 2
             -0.00086672,  # 1, 3
             -0.00069415,  # 2, 0
              0.00717613,  # 2, 1
             -0.01074585,  # 2, 2
             -0.00125227,  # 2, 3
             -0.00610306,  # 3, 0
             -0.00086672,  # 3, 1
             -0.00125227,  # 3, 2
             -0.00575189,  # 3, 3
             # ----------    a, b     irrep_a = 1  (irrep_b = 1)
             -0.04065767,  # 0, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 2)
             -0.00384435,  # 0, 0
             # ====> pair ij = 23:  (i = 0, i_irrep = 2);  (j = 0, j_irrep = 1)
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 2)
             -0.00791411,  # 0, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 0)
             -0.02889921,  # 0, 0
             # ====> pair ij = 24:  (i = 0, i_irrep 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
             -0.00985632,  # 0, 0
              0.01210219,  # 1, 0
             -0.00917792,  # 2, 0
             -0.00813465,  # 3, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 0)
             -0.00652416,  # 0, 0
              0.00208640,  # 0, 1
             -0.00496870,  # 0, 2
             -0.00674374,  # 0, 3
             # ====> pair ij = 25:  (i = 1, i_irrep 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (irrep_b = 2)
              0.00036483,  # 0, 0
             -0.00344245,  # 1, 0
             -0.02430901,  # 2, 0
              0.00272304,  # 3, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 0)
             -0.00211533,  # 0, 0
              0.00104057,  # 0, 1
             -0.00917737,  # 0, 2
             -0.00049167,  # 0, 3
             # ====> pair ij = 26:  (i = 0, i_irrep = 1); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 2)
             -0.02889921,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
             -0.00791411,  # 0, 0
             # ====> pair ij = 27:  (i = 0, i_irrep = 2);  (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.00911375,  # 0, 0
             -0.00396353,  # 0, 1
             -0.00069415,  # 0, 2
             -0.00610306,  # 0, 3
             -0.00396353,  # 1, 0
             -0.01256441,  # 1, 1
              0.00717613,  # 1, 2
             -0.00086672,  # 1, 3
             -0.00069415,  # 2, 0
              0.00717613,  # 2, 1
             -0.01074585,  # 2, 2
             -0.00125227,  # 2, 3
             -0.00610306,  # 3, 0
             -0.00086672,  # 3, 1
             -0.00125227,  # 3, 2
             -0.00575189,  # 3, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00384435,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.04065767   # 0, 0
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)
        wf = IntermNormWaveFunction.restrict(wf)
        self.assertTrue(wf.restricted)
        my_ampl = np.array(
            # Singles:
            [# ----------    i, a    irrep = 0
             -0.00014166,  # 0, 0
             -0.00315634,  # 0, 1
              0.00174224,  # 0, 2
             -0.00075553,  # 0, 3
             -0.00087725,  # 1, 0
              0.00203402,  # 1, 1
              0.00606624,  # 1, 2
             -0.00102091,  # 1, 3
             # ----------    i, a    irrep = 1
              0.00731866,  # 0, 0
             # ----------    i, a    irrep = 2
              0.00731866,  # 0, 0
             # ==============================================
             # Doubles:
             # ====> pair ij = 0:   (i = 0, i_irrep = 0); (j = 0, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
             -0.00792707,  # 0, 0
              0.00309373,  # 0, 1
             -0.00187224,  # 0, 2
             -0.01071886,  # 0, 3
              0.00309373,  # 1, 0
             -0.01368087,  # 1, 1
              0.00048542,  # 1, 2
             -0.00421862,  # 1, 3
             -0.00187224,  # 2, 0
              0.00048542,  # 2, 1
             -0.00387597,  # 2, 2
             -0.00277093,  # 2, 3
             -0.01071886,  # 3, 0
             -0.00421862,  # 3, 1
             -0.00277093,  # 3, 2
             -0.02225884,  # 3, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00674917,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.00674917,  # 0, 0
             # ====> pair ij = 1:   (i = 0, i_irrep = 0); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0  (=> irrep_b = 0)
              0.00486590,  # 0, 0
             -0.00146212,  # 0, 1
             -0.00476326,  # 0, 2
              0.00669938,  # 0, 3
              0.00079211,  # 1, 0
              0.00963770,  # 1, 1
              0.00710552,  # 1, 2
              0.00844545,  # 1, 3
              0.00078957,  # 2, 0
              0.00209965,  # 2, 1
             -0.01024934,  # 2, 2
              0.00450950,  # 2, 3
              0.00697936,  # 3, 0
              0.00516810,  # 3, 1
             -0.00118494,  # 3, 2
              0.01544026,  # 3, 3
             # ----------    a, b    irrep_a = 1  (=> irrep_b = 1)
             -0.00407663,  # 0, 0
             # ----------    a, b    irrep_a = 2  (=> irrep_b = 2)
             -0.00407663,  # 0, 0
             # ====> pair ij = 2:  (i = 1, i_irrep 0); (j = 1, j_irrep = 0)
             # ----------    a, b    irrep_a = 0
             -0.02275450,  # 0, 0
             -0.00720109,  # 0, 1
              0.00303153,  # 0, 2
             -0.01575975,  # 0, 3
             -0.00720109,  # 1, 0
             -0.00989622,  # 1, 1
             -0.00111353,  # 1, 2
             -0.01084226,  # 1, 3
              0.00303153,  # 2, 0
             -0.00111353,  # 2, 1
             -0.03064355,  # 2, 2
              0.00877140,  # 2, 3
             -0.01575975,  # 3, 0
             -0.01084226,  # 3, 1
              0.00877140,  # 3, 2
             -0.02266788,  # 3, 3
             # ----------    a, b     irrep_a = 1
             -0.00550082,  # 0, 0
             # ----------    a, b     irrep_a = 2
             -0.00550082,  # 0, 0
             # ====> pair ij = 3:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0
             -0.00985632,  # 0, 0
              0.01210219,  # 1, 0
             -0.00917792,  # 2, 0
             -0.00813465,  # 3, 0
             # ----------    a, b     irrep_a = 1
             -0.00652416,  # 0, 0
              0.00208640,  # 0, 1
             -0.00496870,  # 0, 2
             -0.00674374,  # 0, 3
             # ====> pair ij = 4:  (i = 1, i_irrep =  0); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (irrep_b = 1)
              0.00036483,  # 0, 0
             -0.00344245,  # 1, 0
             -0.02430901,  # 2, 0
              0.00272304,  # 3, 0
             # ----------    a, b     irrep_a = 1  (irrep_b = 0)
             -0.00211533,  # 0, 0
              0.00104057,  # 0, 1
             -0.00917737,  # 0, 2
             -0.00049167,  # 0, 3
             # ====> pair ij = 5:  (i = 0, i_irrep = 1); (j = 0, j_irrep = 1)
             # ----------    a, b     irrep_a = 0  (irrep_b = 0)
             -0.00911375,  # 0, 0
             -0.00396353,  # 0, 1
             -0.00069415,  # 0, 2
             -0.00610306,  # 0, 3
             -0.00396353,  # 1, 0
             -0.01256441,  # 1, 1
              0.00717613,  # 1, 2
             -0.00086672,  # 1, 3
             -0.00069415,  # 2, 0
              0.00717613,  # 2, 1
             -0.01074585,  # 2, 2
             -0.00125227,  # 2, 3
             -0.00610306,  # 3, 0
             -0.00086672,  # 3, 1
             -0.00125227,  # 3, 2
             -0.00575189,  # 3, 3
             # ----------    a, b     irrep_a = 1  (irrep_b = 1)
             -0.04065767,  # 0, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 2)
             -0.00384435,  # 0, 0
             # ====> pair ij = 6:  (i = 0, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 2)
             -0.00985632,  # 0, 0
              0.01210219,  # 1, 0
             -0.00917792,  # 2, 0
             -0.00813465,  # 3, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 0)
             -0.00652416,  # 0, 0
              0.00208640,  # 0, 1
             -0.00496870,  # 0, 2
             -0.00674374,  # 0, 3
             # ====> pair ij = 7: (i = 1, i_irrep = 0); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (irrep_b = 2)
              0.00036483,  # 0, 0
             -0.00344245,  # 1, 0
             -0.02430901,  # 2, 0
              0.00272304,  # 3, 0
             # ----------    a, b     irrep_a = 2  (irrep_b = 0)
             -0.00211533,  # 0, 0
              0.00104057,  # 0, 1
             -0.00917737,  # 0, 2
             -0.00049167,  # 0, 3
             # ====> pair ij = 8: (i = 0, i_irrep = 1);  (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 2)
             -0.02889921,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 0)
             -0.00791411,  # 0, 0
             # ====> pair ij = 9: (i = 0, i_irrep = 2); (j = 0, j_irrep = 2)
             # ----------    a, b     irrep_a = 0  (=> irrep_b = 0)
             -0.00911375,  # 0, 0
             -0.00396353,  # 0, 1
             -0.00069415,  # 0, 2
             -0.00610306,  # 0, 3
             -0.00396353,  # 1, 0
             -0.01256441,  # 1, 1
              0.00717613,  # 1, 2
             -0.00086672,  # 1, 3
             -0.00069415,  # 2, 0
              0.00717613,  # 2, 1
             -0.01074585,  # 2, 2
             -0.00125227,  # 2, 3
             -0.00610306,  # 3, 0
             -0.00086672,  # 3, 1
             -0.00125227,  # 3, 2
             -0.00575189,  # 3, 3
             # ----------    a, b     irrep_a = 1  (=> irrep_b = 1)
             -0.00384435,  # 0, 0
             # ----------    a, b     irrep_a = 2  (=> irrep_b = 2)
             -0.04065767   # 0, 0
            ])
        self.assertEqual(wf.get_amplitudes(), my_ampl)

    def test_hcl_plus_631g_c2v(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('HCl_plus__1.5__631g__C2v'))
        with self.assertRaises(ValueError):
            IntermNormWaveFunction.restrict(wf)

    def test_hcl_plus_631g_cs(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('HCl_plus__1.5__631g__Cs'))
        with self.assertRaises(ValueError):
            IntermNormWaveFunction.restrict(wf)

    def test_h2o_sto3g_c2v(self):
        dir_name = 'h2o__1.5__sto3g__C2v'
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file(dir_name))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CISD_file(dir_name))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file(dir_name, allE=True))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CISD_file(dir_name, allE=True))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
    
    def test_h2o_req_631g_c2v(self):
        dir_name = 'h2o__Req__631g__C2v'
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file(dir_name))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CISD_file(dir_name))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file(dir_name, allE=True))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
        # -----------
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CISD_file(dir_name, allE=True))
        self.assertTrue(wf.restricted)
        ur_wf = IntermNormWaveFunction.unrestrict(wf)
        self.assertFalse(ur_wf.restricted)
        r_wf = IntermNormWaveFunction.restrict(ur_wf)
        self.assertTrue(r_wf.restricted)
        self.assertEqual(wf.get_amplitudes(), r_wf.get_amplitudes())
        
    def test_profiling(self):
        wf = IntermNormWaveFunction.from_Molpro(
            tests.CCSD_file('N2__3__631g__D2h'))
        self.assertTrue(wf.restricted)
        cProfile.runctx('IntermNormWaveFunction.unrestrict(wf)', globals(), locals(), 'run_stats')
        p = pstats.Stats('run_stats')
        p.sort_stats(SortKey.TIME)
        p.print_stats()
